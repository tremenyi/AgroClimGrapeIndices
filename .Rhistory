tmax_by_cells <- extract_variable_from_files_by_cells(target_files = tmax_files, target_domain, wine_region_polygons_target_cells)
time_tmax_end <- Sys.time()
View(tmax_by_cells)
tmax_files <- dir(path = "/rdsi/public/CFA/BoM_daily_vars/tmax/", pattern = "*.nc", full.names = TRUE)
tmax_files <- tmax_files[1:24]
time_tmax_start <- Sys.time()
tmax_by_cells <- extract_variable_from_files_by_cells(target_files = tmax_files, target_domain, wine_region_polygons_target_cells)
library(AgroClimGrapeIndices)
tmax_files <- dir(path = "/rdsi/public/CFA/BoM_daily_vars/tmax/", pattern = "*.nc", full.names = TRUE)
tmax_files <- tmax_files[1:24]
time_tmax_start <- Sys.time()
tmax_by_cells <- extract_variable_from_files_by_cells(target_files = tmax_files, target_domain, wine_region_polygons_target_cells)
time_tmax_end <- Sys.time()
print(paste("tmax time: ", time_tmax_end - time_tmax_start))
(2/24)*684
time_start <- Sys.time()
target_domain <- c("bom")
tmax_files <- dir(path = "/rdsi/public/CFA/BoM_daily_vars/tmax/", pattern = "*.nc", full.names = TRUE)
tmax_files <- tmax_files[1:24]
time_tmax_start <- Sys.time()
tmax_by_cells <- extract_variable_from_files_by_cells(target_files = tmax_files, target_domain, wine_region_polygons_target_cells)
time_tmax_end <- Sys.time()
tmin_files <- dir(path = "/rdsi/public/CFA/BoM_daily_vars/tmin/", pattern = "*.nc", full.names = TRUE)
tmin_files <- tmin_files[1:24]
time_tmin_start <- Sys.time()
tmin_by_cells <- extract_variable_from_files_by_cells(target_files = tmin_files, target_domain, wine_region_polygons_target_cells)
time_tmin_end <- Sys.time()
rain_files <- dir(path = "/rdsi/public/CFA/BoM_daily_vars/rain/", pattern = "*.nc", full.names = TRUE)
rain_files <- rain_files[1:24]
time_rain_start <- Sys.time()
rain_by_cells <- extract_variable_from_files_by_cells(target_files = rain_files, target_domain, wine_region_polygons_target_cells)
time_rain_end <- Sys.time()
time_end <- Sys.time()
print(paste("Total time:", time_end - time_start))
print(paste("tmax time: ", time_tmax_end - time_tmax_start))
print(paste("tmin time: ", time_tmin_end - time_tmin_start))
print(paste("rain time: ", time_rain_end - time_rain_start))
rain_files <- dir(path = "/rdsi/public/CFA/BoM_daily_vars/rain_recal/", pattern = "*.nc", full.names = TRUE)
rain_files <- rain_files[1:24]
time_rain_start <- Sys.time()
rain_by_cells <- extract_variable_from_files_by_cells(target_files = rain_files, target_domain, wine_region_polygons_target_cells)
time_rain_end <- Sys.time()
print(paste("rain time: ", time_rain_end - time_rain_start))
params <- c(base_budb = 3.5,
base_leaf = 7.1,
bracket_budb_leaf = 350,
bracket_leaf_pick = 1000,
DMT_threshold_pctile = 95,
climatology_start = 1962,
climatology_end = 1990,
min_duration = 3,
downy_mildew_threshold_temp = 10
)
a <- "Asdfasdf"
a[1]
a <- c("Asdfasdf", "asdfsd")
a[1]
# source data files for tmax, tmin and rain
src_tmax_files <- dir(path = "/rdsi/public/CFA/BoM_daily_vars/tmax/", pattern = "*.nc", full.names = TRUE)
src_tmax_files <- tmax_files[1:24]
src_tmin_files <- dir(path = "/rdsi/public/CFA/BoM_daily_vars/tmin/", pattern = "*.nc", full.names = TRUE)
src_tmin_files <- tmin_files[1:24]
src_rain_files <- dir(path = "/rdsi/public/CFA/BoM_daily_vars/rain_recal/", pattern = "*.nc", full.names = TRUE)
src_rain_files <- rain_files[1:24]
time_df_tas <- make_time_dataframe_from_nc_files(src_tmax_files[1])
time_df_tas <- make_time_dataframe_from_nc_files(src_tmax_files[1])
View(time_df_tas)
time_df_tas <- make_time_dataframe_from_nc_files(src_tmax_files)
View(time_df_tas)
wine_region_bom_tas_daily <- build_data_tbl(time_df_tas, tmax_by_cells, tmin_by_cells, rain_by_cells)
View(tmax_by_cells)
View(wine_region_bom_tas_daily)
library(AgroClimGrapeIndices)
wine_region_variables_with_stats <- calulate_stats_for_cells(shapes, wine_region_bom_tas_daily, params)
wine_region_variables_with_stats <- calculate_stats_for_cells(shapes, wine_region_bom_tas_daily, params)
wine_region_bom_tas_daily <- wine_region_bom_tas_daily %>% filter(cell == min(cell))
View(wine_region_bom_tas_daily)
library(AgroClimGrapeIndices)
wine_region_variables_with_stats <- calculate_stats_for_cells(shapes, wine_region_bom_tas_daily, params)
warnings()
library(AgroClimGrapeIndices)
wine_region_variables_with_stats <- calculate_stats_for_cells(shapes, wine_region_bom_tas_daily, params)
library(AgroClimGrapeIndices)
wine_region_variables_with_stats <- calculate_stats_for_cells(shapes, wine_region_bom_tas_daily, params)
warnings()
View(wine_region_variables_with_stats)
wine_region_variables_with_stats <- calculate_stats_for_cells(shapes, wine_region_bom_tas_daily, params)
variables_with_stats <- data_table %>%
# pass over data when grouped by area, year, month
do(log_calc_stats_by_area_year_month(.)) %>%
group_by(object_, Austral_season_year, Austral_season_month) %>%
arrange(object_, Austral_season_year, Austral_season_month) %>%
do(calc_stats_by_area_year_month(., params)) %>%
ungroup()
data_table <- wine_region_bom_tas_daily
variables_with_stats <- data_table %>%
# pass over data when grouped by area, year, month
do(log_calc_stats_by_area_year_month(.)) %>%
group_by(object_, Austral_season_year, Austral_season_month) %>%
arrange(object_, Austral_season_year, Austral_season_month) %>%
do(calc_stats_by_area_year_month(., params)) %>%
ungroup()
variables_with_stats <- data_table %>%
# pass over data when grouped by area, year, month
# do(log_calc_stats_by_area_year_month(.)) %>%
group_by(object_, Austral_season_year, Austral_season_month) %>%
arrange(object_, Austral_season_year, Austral_season_month) %>%
do(calc_stats_by_area_year_month(., params)) %>%
ungroup()
library(AgroClimGrapeIndices)
wine_region_variables_with_stats <- calculate_stats_for_cells(shapes, wine_region_bom_tas_daily, params)
library(AgroClimGrapeIndices)
library(AgroClimGrapeIndices)
wine_region_variables_with_stats <- calculate_stats_for_cells(shapes, wine_region_bom_tas_daily, params)
library(AgroClimGrapeIndices)
library(AgroClimGrapeIndices)
wine_region_variables_with_stats <- calculate_stats_for_cells(shapes, wine_region_bom_tas_daily, params)
library(AgroClimGrapeIndices)
wine_region_variables_with_stats <- calculate_stats_for_cells(shapes, wine_region_bom_tas_daily, params)
warnings()
library(AgroClimGrapeIndices)
wine_region_variables_with_stats <- calculate_stats_for_cells(shapes, wine_region_bom_tas_daily, params)
library(AgroClimGrapeIndices)
wine_region_variables_with_stats <- calculate_stats_for_cells(shapes, wine_region_bom_tas_daily, params)
load("/mnt/drollins_workspace/data/wine_region_polygon_matching_indices_for_each_domain.RData")
View(wine_region_polygons_target_cells)
library(AgroClimGrapeIndices)
# calc GDD for BoM data
library(raster)
library(RmarineHeatWaves)
library(plyr)
library(dplyr)
library(sf)
library(stringr)
library(future)
library(zoo)
library(ggplot2)
ColourBlindFriendlyPalette <- c("#000000", "#999999", "#0072B2", "#56B4E9", "#009E73", "#F0E442", "#E69F00", "#D55E00", "#CC79A7")
library(AgroClimGrapeIndices)
if(FALSE) {
load('/mnt/drollins_workspace/data/tmin_by_cells.Rdata')
load('/mnt/drollins_workspace/data/tmax_by_cells.Rdata')
load('/mnt/drollins_workspace/data/rain_by_cells.Rdata')
load('/mnt/drollins_workspace/data/stats.Rdata')
}
# Source data -------------------------------------------------------------
src_code_workspace <- '/mnt/drollins_workspace'
setwd(src_code_workspace)
# source data files for tmax, tmin and rain
src_tmax_files <- dir(path = "/rdsi/public/CFA/BoM_daily_vars/tmax/", pattern = "*.nc", full.names = TRUE)
src_tmin_files <- dir(path = "/rdsi/public/CFA/BoM_daily_vars/tmin/", pattern = "*.nc", full.names = TRUE)
src_rain_files <- dir(path = "/rdsi/public/CFA/BoM_daily_vars/rain_recal/", pattern = "*.nc", full.names = TRUE)
# subset files for testing if desired, each file contains one month
src_tmax_files <- src_tmax_files[1:24]
src_tmin_files <- src_tmin_files[1:24]
src_rain_files <- src_rain_files[1:24]
# get names of each region from the corresponding shapefile
target_shape_dir <- "/mnt/WineAustralia_working_files/shapes/Wine-Regions-GI-Regions/individual_shp"
# shape file with bom districts for Tasmania
src_bom_district_shapes_tas <- "/mnt/external-data/BoM-Forecast-Regions/Tasmanian_post_gfe_forecast_districts.shp"
# source shape files with state boundaries for output graphs
src_state_boundaries_shape = "/mnt/WineAustralia_working_files/shapes/Wine-Regions-GI-Regions/state_boundaries.shp"
# BOM districts for tasmania to convert to regions, and whether to prepend "Tasmania" to the region label
target_bom_districts_tas <- list(
c(prepend = FALSE, label = "King Island"),
c(prepend = FALSE, label = "Furneaux Islands"),
c(prepend = TRUE,  label = "North West Coast"),
c(prepend = TRUE,  label = "North East"),
c(prepend = TRUE,  label = "Central North"),
c(prepend = TRUE,  label = "East Coast"),
c(prepend = TRUE,  label = "Upper Derwent Valley"),
c(prepend = TRUE,  label = "South East")
)
# Build geometries --------------------------------------------------------
# get shapes for all wine regions from sources
shapes <- get_all_wine_region_shapes(target_shape_dir, src_bom_district_shapes_tas, target_bom_districts_tas)
# drop all metadata for shapes and just keep geometries for main cell spatial extract processing
shapes_g <- extract_geom_for_shapes(shapes)
# temp at surface (max) brick can be used for time series and spatial transform for tmax, tmin and rain
# because the projection is the same
tmax_brick <- raster::brick(src_tmax_files[1], quick = TRUE)
shp_spatial_transformed <- make_transformed_spatial_shape(shapes_g, tmax_brick)
library(AgroClimGrapeIndices)
shapes <- get_all_wine_region_shapes(target_shape_dir, src_bom_district_shapes_tas, target_bom_districts_tas)
shapes_g <- extract_geom_for_shapes(shapes)
tmax_brick <- raster::brick(src_tmax_files[1], quick = TRUE)
shp_spatial_transformed <- make_transformed_spatial_shape(shapes_g, tmax_brick)
time_tmax_start <- Sys.time()
tmax_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmax_files, target_domain, wine_region_polygons_target_cells)
time_tmax_end <- Sys.time()
target_domain <- c("bom")
time_tmax_start <- Sys.time()
tmax_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmax_files, target_domain, wine_region_polygons_target_cells)
time_tmax_end <- Sys.time()
print(paste("tmax time: ", time_tmax_end - time_tmax_start))
library(AgroClimGrapeIndices)
rm(tmax_by_cells)
time_tmax_start <- Sys.time()
tmax_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmax_files, target_domain, wine_region_polygons_target_cells)
time_tmax_end <- Sys.time()
print(paste("tmax time: ", time_tmax_end - time_tmax_start))
time_start <- Sys.time()
time_tmax_start <- Sys.time()
tmax_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmax_files, target_domain, wine_region_polygons_target_cells)
time_tmax_end <- Sys.time()
time_tmin_start <- Sys.time()
tmin_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmin_files, target_domain, wine_region_polygons_target_cells)
time_tmin_end <- Sys.time()
time_rain_start <- Sys.time()
rain_by_cells <- extract_variable_from_files_by_cells(target_files = src_rain_files, target_domain, wine_region_polygons_target_cells)
time_rain_end <- Sys.time()
time_end <- Sys.time()
cat("tmax time: ", time_tmax_end - time_tmax_start, "\n")
cat("tmin time: ", time_tmin_end - time_tmin_start, "\n")
cat("rain time: ", time_rain_end - time_rain_start, "\n")
cat("Total time:", time_end - time_start, "\n")
library(AgroClimGrapeIndices)
time_start <- Sys.time()
time_tmax_start <- Sys.time()
tmax_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmax_files, target_domain, wine_region_polygons_target_cells)
time_tmax_end <- Sys.time()
time_tmin_start <- Sys.time()
tmin_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmin_files, target_domain, wine_region_polygons_target_cells)
time_tmin_end <- Sys.time()
time_rain_start <- Sys.time()
rain_by_cells <- extract_variable_from_files_by_cells(target_files = src_rain_files, target_domain, wine_region_polygons_target_cells)
time_rain_end <- Sys.time()
time_end <- Sys.time()
cat("tmax time: ", time_tmax_end - time_tmax_start, "\n")
cat("tmin time: ", time_tmin_end - time_tmin_start, "\n")
cat("rain time: ", time_rain_end - time_rain_start, "\n")
cat("Total time:", time_end - time_start, "\n")
time_tmax_start <- Sys.time()
tmax <- cell_extract_spatial(src_tmax_files, shp_spatial_transformed)
time_tmax_end <- Sys.time()
time_tmin_start <- Sys.time()
tmin <- cell_extract_spatial(src_tmin_files, shp_spatial_transformed)
time_tmin_end <- Sys.time()
time_rain_start <- Sys.time()
rain <- cell_extract_spatial(src_rain_files, shp_spatial_transformed)
time_rain_end <- Sys.time()
# time_tmax_start <- Sys.time()
# tmax_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmax_files, target_domain, wine_region_polygons_target_cells)
# time_tmax_end <- Sys.time()
#
# time_tmin_start <- Sys.time()
# tmin_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmin_files, target_domain, wine_region_polygons_target_cells)
# time_tmin_end <- Sys.time()
#
# time_rain_start <- Sys.time()
# rain_by_cells <- extract_variable_from_files_by_cells(target_files = src_rain_files, target_domain, wine_region_polygons_target_cells)
# time_rain_end <- Sys.time()
#
# time_end <- Sys.time()
cat("tmax time: ", time_tmax_end - time_tmax_start, "\n")
cat("tmin time: ", time_tmin_end - time_tmin_start, "\n")
cat("rain time: ", time_rain_end - time_rain_start, "\n")
cat("Total time:", time_end - time_start, "\n")
time_end <- Sys.time()
cat("Total time:", time_end - time_start, "\n")
time_tmax_start <- Sys.time()
tmax <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_tmax_files, shp_spatial_transformed)
time_tmax_end <- Sys.time()
time_tmin_start <- Sys.time()
tmin <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_tmin_files, shp_spatial_transformed)
time_tmin_end <- Sys.time()
time_rain_start <- Sys.time()
rain <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_rain_files, shp_spatial_transformed)
time_rain_end <- Sys.time()
# time_tmax_start <- Sys.time()
# tmax_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmax_files, target_domain, wine_region_polygons_target_cells)
# time_tmax_end <- Sys.time()
#
# time_tmin_start <- Sys.time()
# tmin_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmin_files, target_domain, wine_region_polygons_target_cells)
# time_tmin_end <- Sys.time()
#
# time_rain_start <- Sys.time()
# rain_by_cells <- extract_variable_from_files_by_cells(target_files = src_rain_files, target_domain, wine_region_polygons_target_cells)
# time_rain_end <- Sys.time()
#
time_end <- Sys.time()
cat("tmax time: ", time_tmax_end - time_tmax_start, "\n")
cat("tmin time: ", time_tmin_end - time_tmin_start, "\n")
cat("rain time: ", time_rain_end - time_rain_start, "\n")
cat("Total time:", time_end - time_start, "\n")
time_start <- Sys.time()
time_tmax_start <- Sys.time()
tmax <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_tmax_files, shp_spatial_transformed)
time_tmax_end <- Sys.time()
time_tmin_start <- Sys.time()
tmin <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_tmin_files, shp_spatial_transformed)
time_tmin_end <- Sys.time()
time_rain_start <- Sys.time()
rain <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_rain_files, shp_spatial_transformed)
time_rain_end <- Sys.time()
# time_tmax_start <- Sys.time()
# tmax_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmax_files, target_domain, wine_region_polygons_target_cells)
# time_tmax_end <- Sys.time()
#
# time_tmin_start <- Sys.time()
# tmin_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmin_files, target_domain, wine_region_polygons_target_cells)
# time_tmin_end <- Sys.time()
#
# time_rain_start <- Sys.time()
# rain_by_cells <- extract_variable_from_files_by_cells(target_files = src_rain_files, target_domain, wine_region_polygons_target_cells)
# time_rain_end <- Sys.time()
#
time_end <- Sys.time()
cat("tmax time: ", time_tmax_end - time_tmax_start, "\n")
cat("tmin time: ", time_tmin_end - time_tmin_start, "\n")
cat("rain time: ", time_rain_end - time_rain_start, "\n")
cat("Total time:", time_end - time_start, "\n")
library(AgroClimGrapeIndices)
time_start <- Sys.time()
time_tmax_start <- Sys.time()
tmax <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_tmax_files, shp_spatial_transformed)
time_tmax_end <- Sys.time()
time_tmin_start <- Sys.time()
tmin <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_tmin_files, shp_spatial_transformed)
time_tmin_end <- Sys.time()
time_rain_start <- Sys.time()
rain <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_rain_files, shp_spatial_transformed)
time_rain_end <- Sys.time()
# time_tmax_start <- Sys.time()
# tmax_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmax_files, target_domain, wine_region_polygons_target_cells)
# time_tmax_end <- Sys.time()
#
# time_tmin_start <- Sys.time()
# tmin_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmin_files, target_domain, wine_region_polygons_target_cells)
# time_tmin_end <- Sys.time()
#
# time_rain_start <- Sys.time()
# rain_by_cells <- extract_variable_from_files_by_cells(target_files = src_rain_files, target_domain, wine_region_polygons_target_cells)
# time_rain_end <- Sys.time()
#
time_end <- Sys.time()
cat("tmax time: ", time_tmax_end - time_tmax_start, "\n")
cat("tmin time: ", time_tmin_end - time_tmin_start, "\n")
cat("rain time: ", time_rain_end - time_rain_start, "\n")
cat("Total time:", time_end - time_start, "\n")
unique(
unlist(
lapply(wine_region_polygon_cells_per_domain_lookup, function(x) { x[["matching_cells"]][[target_domain_key]] })
)
)
target_cell_indices <- get_target_cell_indices_for_domain(target_domain, wine_region_polygon_cells_per_domain_lookup)
target_cell_indices <- get_target_cell_indices_for_domain(target_domain, wine_region_polygons_target_cells)
time_start <- Sys.time()
time_tmax_start <- Sys.time()
tmax <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_tmax_files, wine_region_polygons_target_cells)
time_tmax_end <- Sys.time()
time_tmin_start <- Sys.time()
tmin <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_tmin_files, wine_region_polygons_target_cells)
time_tmin_end <- Sys.time()
time_rain_start <- Sys.time()
rain <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_rain_files, wine_region_polygons_target_cells)
time_rain_end <- Sys.time()
# time_tmax_start <- Sys.time()
# tmax_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmax_files, target_domain, wine_region_polygons_target_cells)
# time_tmax_end <- Sys.time()
#
# time_tmin_start <- Sys.time()
# tmin_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmin_files, target_domain, wine_region_polygons_target_cells)
# time_tmin_end <- Sys.time()
#
# time_rain_start <- Sys.time()
# rain_by_cells <- extract_variable_from_files_by_cells(target_files = src_rain_files, target_domain, wine_region_polygons_target_cells)
# time_rain_end <- Sys.time()
#
time_end <- Sys.time()
cat("tmax time: ", time_tmax_end - time_tmax_start, "\n")
cat("tmin time: ", time_tmin_end - time_tmin_start, "\n")
cat("rain time: ", time_rain_end - time_rain_start, "\n")
cat("Total time:", time_end - time_start, "\n")
time_start <- Sys.time()
time_tmax_start <- Sys.time()
tmax <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_tmax_files, wine_region_polygons_target_cells)
time_tmax_end <- Sys.time()
time_tmin_start <- Sys.time()
tmin <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_tmin_files, wine_region_polygons_target_cells)
time_tmin_end <- Sys.time()
time_rain_start <- Sys.time()
rain <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_rain_files, wine_region_polygons_target_cells)
time_rain_end <- Sys.time()
# time_tmax_start <- Sys.time()
# tmax_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmax_files, target_domain, wine_region_polygons_target_cells)
# time_tmax_end <- Sys.time()
#
# time_tmin_start <- Sys.time()
# tmin_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmin_files, target_domain, wine_region_polygons_target_cells)
# time_tmin_end <- Sys.time()
#
# time_rain_start <- Sys.time()
# rain_by_cells <- extract_variable_from_files_by_cells(target_files = src_rain_files, target_domain, wine_region_polygons_target_cells)
# time_rain_end <- Sys.time()
#
time_end <- Sys.time()
cat("tmax time: ", time_tmax_end - time_tmax_start, "\n")
cat("tmin time: ", time_tmin_end - time_tmin_start, "\n")
cat("rain time: ", time_rain_end - time_rain_start, "\n")
cat("Total time:", time_end - time_start, "\n")
library(AgroClimGrapeIndices)
time_start <- Sys.time()
time_tmax_start <- Sys.time()
tmax <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_tmax_files, wine_region_polygons_target_cells)
time_tmax_end <- Sys.time()
time_tmin_start <- Sys.time()
tmin <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_tmin_files, wine_region_polygons_target_cells)
time_tmin_end <- Sys.time()
time_rain_start <- Sys.time()
rain <- AgroClimGrapeIndices:::cell_extract_spatial_variant(src_rain_files, wine_region_polygons_target_cells)
time_rain_end <- Sys.time()
# time_tmax_start <- Sys.time()
# tmax_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmax_files, target_domain, wine_region_polygons_target_cells)
# time_tmax_end <- Sys.time()
#
# time_tmin_start <- Sys.time()
# tmin_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmin_files, target_domain, wine_region_polygons_target_cells)
# time_tmin_end <- Sys.time()
#
# time_rain_start <- Sys.time()
# rain_by_cells <- extract_variable_from_files_by_cells(target_files = src_rain_files, target_domain, wine_region_polygons_target_cells)
# time_rain_end <- Sys.time()
#
time_end <- Sys.time()
cat("tmax time: ", time_tmax_end - time_tmax_start, "\n")
cat("tmin time: ", time_tmin_end - time_tmin_start, "\n")
cat("rain time: ", time_rain_end - time_rain_start, "\n")
cat("Total time:", time_end - time_start, "\n")
time_start <- Sys.time()
time_tmax_start <- Sys.time()
tmax <- cell_extract_spatial_file_list(src_tmax_files, shp_spatial_transformed)
time_tmax_end <- Sys.time()
time_tmin_start <- Sys.time()
tmin <- cell_extract_spatial_file_list(src_tmin_files, shp_spatial_transformed)
time_tmin_end <- Sys.time()
time_rain_start <- Sys.time()
rain <- cell_extract_spatial_file_list(src_rain_files, shp_spatial_transformed)
time_rain_end <- Sys.time()
# time_tmax_start <- Sys.time()
# tmax_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmax_files, target_domain, wine_region_polygons_target_cells)
# time_tmax_end <- Sys.time()
#
# time_tmin_start <- Sys.time()
# tmin_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmin_files, target_domain, wine_region_polygons_target_cells)
# time_tmin_end <- Sys.time()
#
# time_rain_start <- Sys.time()
# rain_by_cells <- extract_variable_from_files_by_cells(target_files = src_rain_files, target_domain, wine_region_polygons_target_cells)
# time_rain_end <- Sys.time()
#
time_end <- Sys.time()
cat("tmax time: ", time_tmax_end - time_tmax_start, "\n")
cat("tmin time: ", time_tmin_end - time_tmin_start, "\n")
cat("rain time: ", time_rain_end - time_rain_start, "\n")
cat("Total time:", time_end - time_start, "\n")
src_tmax_files <- dir(path = "/rdsi/public/CFA/BoM_daily_vars/tmax/", pattern = "*.nc", full.names = TRUE)
src_tmin_files <- dir(path = "/rdsi/public/CFA/BoM_daily_vars/tmin/", pattern = "*.nc", full.names = TRUE)
src_rain_files <- dir(path = "/rdsi/public/CFA/BoM_daily_vars/rain_recal/", pattern = "*.nc", full.names = TRUE)
time_start <- Sys.time()
#
# time_tmax_start <- Sys.time()
# tmax <- cell_extract_spatial_file_list(src_tmax_files, shp_spatial_transformed)
# time_tmax_end <- Sys.time()
# time_tmin_start <- Sys.time()
# tmin <- cell_extract_spatial_file_list(src_tmin_files, shp_spatial_transformed)
# time_tmin_end <- Sys.time()
# time_rain_start <- Sys.time()
# rain <- cell_extract_spatial_file_list(src_rain_files, shp_spatial_transformed)
# time_rain_end <- Sys.time()
# time_tmax_start <- Sys.time()
# tmax_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmax_files, target_domain, wine_region_polygons_target_cells)
# time_tmax_end <- Sys.time()
time_tmin_start <- Sys.time()
tmin_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmin_files, target_domain, wine_region_polygons_target_cells)
time_tmin_end <- Sys.time()
time_rain_start <- Sys.time()
rain_by_cells <- extract_variable_from_files_by_cells(target_files = src_rain_files, target_domain, wine_region_polygons_target_cells)
time_rain_end <- Sys.time()
time_end <- Sys.time()
cat("tmax time: ", time_tmax_end - time_tmax_start, "\n")
cat("tmin time: ", time_tmin_end - time_tmin_start, "\n")
cat("rain time: ", time_rain_end - time_rain_start, "\n")
cat("Total time:", time_end - time_start, "\n")
save(rain_by_cells, file = '/mnt/drollins_workspace/data/bom_rain_by_cells.Rdata')
time_tmax_start <- Sys.time()
tmax_by_cells <- extract_variable_from_files_by_cells(target_files = src_tmax_files, target_domain, wine_region_polygons_target_cells)
time_tmax_end <- Sys.time()
src_rain_files <- dir(path = "/rdsi/public/CFA/BoM_daily_vars/rain_recal/", pattern = "*.nc", full.names = TRUE)
cat("tmax time: ", time_tmax_end - time_tmax_start, "\n")
cat("tmin time: ", time_tmin_end - time_tmin_start, "\n")
cat("rain time: ", time_rain_end - time_rain_start, "\n")
cat("Total time:", time_end - time_start, "\n")
save(tmax_by_cells, file = '/mnt/drollins_workspace/data/bom_tmax_by_cells.Rdata')
params <- c(base_budb = 3.5,
base_leaf = 7.1,
bracket_budb_leaf = 350,
bracket_leaf_pick = 1000,
DMT_threshold_pctile = 95,
climatology_start = 1962,
climatology_end = 1990,
min_duration = 3,
downy_mildew_threshold_temp = 10
)
rm(tmax)
rm(tmin)
rm(rain)
time_df_tas <- make_time_dataframe_from_nc_files(src_tmax_files)
wine_region_bom_tas_daily <- build_data_tbl(time_df_tas, tmax_by_cells, tmin_by_cells, rain_by_cells)
save(wine_region_bom_tas_daily, file = '/mnt/drollins_workspace/data/bom_daily_data_tbl_by_cells.Rdata')
head(wine_region_bom_tas_daily)
